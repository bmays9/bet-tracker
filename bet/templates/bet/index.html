{% extends "base.html" %}
{% load static %}
{% block content %}
<!-- content starts here -->

<div class="container top-info-bar">
   <div class="row">
      <div class="col text-start">
         <a href="{% url 'home' %}">Open Bets</a> | 
         <a href="{% url 'settled_list' %}">Settled Bets</a></h1>
      </div>
      <div class="col">
         <span class="money"> Balance:
         {% if user_balance > 0 %}<span class="balance-green"
         {% else %} <span class="balance-red"
         {% endif %}> £ {{ user_balance }}</span>
      </div>
      <div class="col">
         
      </div>
   </div>
</div>
<!-- Container of all bets-->
<div class="container-fluid all-bets">
   {% for bet in open_bets %} 
   <!-- Single Bet Box-->
   <div class="row no-gutters bet-box mb-3">
      <div class="col">
         <!-- Bet Header, wrapped in an anchor-->
         <div class="row no-gutters bet-header">
            <div class="col">
               <a data-bs-toggle="collapse" href="#collapse{{ forloop.counter }}">
                  <div class="row align-items-start">
                     <div class="col-3">
                        <span class="punter">{{ bet.punter }} </span>
                     </div>
                     <div class="col">
                        <span class="stake">£{{ bet.stake }} {{ bet.line_count }}-fold </span>
                     </div>
                     <div class="col-2 text-end">
                        {% if bet.status == 0  %}
                        <span class="badge bg-secondary">Pending</span>
                        {% elif bet.status == 1  %}
                        <span class="badge bg-success">Won</span>
                        {% elif bet.status == -1 %}
                        <span class="badge bg-danger">Lost</span>
                        {% endif %}
                     </div>
                  </div>
               </a>
            </div>
         </div>
         <!-- End Of Bet Header-->                
         <!-- Lines and Footer-->
         <div id="collapse{{ forloop.counter }}" class="row no-gutters panel-collapse {% if forloop.counter > 5 %}collapse{% endif %}">
            <div class="col">
               <ul class="list-group">
                  {% for line in bet.lines.all %}
                  <li class="list-group-item bg-light">
                     <div class="row no-gutters line-details">
                        <div class="col">{{ line.home_team }} v {{ line.away_team }} </div>
                        <div class="col">Prediction: {{ line.prediction}} </div>
                        <div class="col">Odds: {{ line.odds }} </div>
                        <div class="col">{{ line.status }} </div>
                     </div>
                     {% endfor %}
               </ul>
            </div>
         </div>
         <!-- End of lines -->
         <!-- Buttons / Actions -->
         <div class="row no-gutters panel-footer list-group">
            <div class="col">
               {% if user.is_authenticated and bet.punter == user %}
               <a href="{% url 'update_bet' bet.id %}" class="update-link">
               <button class="btn btn-edit btn-info btn-sm" bet_id="{{ bet.id }}">Update</button>
               </a>
               <button type="button" class="btn btn-outline-danger btn-delete btn-sm"  bet_id="{{ bet.id }}">Delete</button> 
               {% endif %}
            </div>
         </div>
         <!-- End of Actions -->
      </div>
   </div>
   {% endfor %}
</div>

<!-- Modal for delete confirmation -->
<div class="modal fade" id="deleteModal" tabindex="-1" data-bs-backdrop="static"
  aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"
          id="deleteModalLabel">Delete Bet?</h5>
        <button type="button" class="btn-close"
          data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this bet and all lines?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary"
          data-bs-dismiss="modal">Close</button>
        <a id="deleteConfirm" href="#" class="btn btn-danger">Delete</a>
      </div>
    </div>
  </div>
</div>


<!-- index.html content ends here -->
{% endblock content %}
{% block additional %}
<script src="{% static 'js/deletebet.js' %}"></script>
{% endblock %}